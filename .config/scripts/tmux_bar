#!/usr/bin/env bash

tmux_bar_sleep1() {
# {{{ #### Update Package
Update=$(apt list --upgradable 2>/dev/null | sed '/\//!d' | wc -l)
[ "$Update" = 0 ] && echo -n "" || echo -n " #[fg=colour71]â”ƒ #[fg=colour11]ğŸ“¦ Updates: $Update"
#### â”â”â”â”â”â”â”â”â”â”â”â”â”â” # }}}
}

tmux_bar_inst(){
# {{{ #### Transmission
Torrent=$(transmission-remote -l \
	| sed -r '/%|Unknown/!d
		s/.*Verifying.*/âŒ›ï¸/
		s/.*Seeding.*/ğŸŒ±/
		s/.*Stopped.*/ğŸ”´/
		s/.*100%.*/âœ…/
		s/.*Idle.*/âŒ›ï¸/
		s/.*Unknown.*/â—/
		s/.*Uploading.*/ğŸ“¤/
		s/ .* (.*%).*Up & Down.*/ğŸ“¥[\1]/
		s/ .* (.*%).*Downloading.*/ğŸ“¥[\1]/' \
	| sort \
	| uniq -c \
	| sed -r 's/ //g
		s/(.*ğŸ”´.*)/#[fg=colour1] \1/
		s/(.*â—.*)/#[fg=colour5] \1/
		s/(.*âŒ›ï¸.*)/#[fg=colour11] \1/
		s/(.*ğŸŒ±.*)/#[fg=colour71] \1/
		s/(.*âœ….*)/#[fg=colour71] \1/
		s/(.*ğŸ“¤.*)/#[fg=colour71] \1/
		s/.*(ğŸ“¥.*$)/#[fg=colour4] \1/' \
	| sed ':a;$!N;s/\n//;ta;' \
	| sed 's/^/ #[fg=colour71]â”ƒ/')
echo -n "$Torrent"
#### â”â”â”â”â”â”â”â”â”â”â”â” # }}}
# {{{ #### Flexget Update
File=~/Flexget-Update.md
Date=$(date '+%d/%m/%Y')
[ ! -f "$File" ] && echo -e "| Data | Titulo | Url |\n| :--: | :----: | :-: |" >> "$File"
FlexgetUP=$(grep -c "$Date" "$File")
[ "$FlexgetUP" = 0 ] && echo -n "" || echo -n " #[fg=colour71]â”ƒ #[fg=colour4]Flexget: $FlexgetUP"
#### â”â”â”â”â”â”â”â”â”â”â”â” # }}}
# {{{ #### Mpc Player
Player=$(mpc -f "[[%artist% â”ƒ ]%title%]|[%file$]" 2>/dev/null \
	| sed -r '/^volume:|^\[playing\]|^\[paused\]/d
		s/(.* )â”ƒ( .*)/ #[fg=colour71]â”ƒ ğŸµ \1-#[fg=colour5]\2/')
echo -n "$Player"
#### â”â”â”â”â”â”â”â”â”â” # }}}
# {{{ #### Temperatura CPU
Temp=$(sensors | sed -r '/Package id 0:/!d;s/.*\+(.*)\..Â°C *\(.*$/ #[fg=colour71]â”ƒ \1Â°C/')
echo -n "$Temp"
#### â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” # }}}
}

####### Atualiza a Cada Minuto #######
if [ "$(date -r /tmp/tmux_bar_sleep1 +%M)" = "$(date '+%M')" ]; then
	cat /tmp/tmux_bar_sleep1 && tmux_bar_inst
else
	tmux_bar_sleep1 > /tmp/tmux_bar_sleep1 && cat /tmp/tmux_bar_sleep1 && tmux_bar_inst
fi
#######â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
